{
  "hash": "10864ac3d9cff03f1b0145468ed1244a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7: Random Effect Structures\"\nparams: \n    SHOW_SOLS: FALSE\n    TOGGLE: TRUE\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n\n\n\n:::lo\nThis reading:  \n\n- Extending the multilevel model to encompass more complex grouping structures\n    - Groups nested inside higher level groups\n    - Non-nested group structures\n\n:::\n\n\n# \"random effects\"\n\n\nSo far, we've fitted various multilevel models that have had grouping structures such as:  \n\n- each observation is a child, and children are grouped into schools\n- each observation is an individual trial or assessment, and multiple observations come from each participants\n- each observation is a single timepoint, and we have multiple timepoints for  each participant  \n\nIn all of these, we have been specifying models with a random effect structure that takes the form `(.... | g)`. \n\nWe're now going to move to look at how multilevel modelling can capture more complex structures - when there is more than just the one grouping variable.  \n\n\n::: {.callout-note collapse=\"true\"}\n#### a small note on how people use the term \"random effects\"  \n\nPeople often use the term \"random effects\" to collectively refer to all of the stuff we're putting in the brakects of `lmer()`: \n\n$$\n\\text{... + }\\underbrace{\\text{(random intercept + random slopes | grouping structure)}}_{\\text{random effects}}\n$$\n\nPeople will use different phrases to refer to individual random intercepts or slopes, such as:  \n\n- *\"random effects of x by g\"* to refer to `... +  x | g)`\n- *\"by-g random effects of x\"* to refer to `... +  x | g)`\n- *\"random effects of x for g\"* to refer to `... +  x | g)`\n- *\"random effect for/of g\"* to refer to `(1 | g)`\n\nThese are all really trying to just different ways to say that a model allows *[insert-parameter-here]* to be different for each group of g, and that it estimates their variance.  \n\n:::\n\n\n<div class=\"divider div-transparent div-dot\"></div>\n\n# Nested\n\nThe same principle we have seen for models with 2 levels can be extended to situations in which those level 2 clusters are themselves grouped in to higher level clusters.  \n\nFor instance:  \n\n- each observation is a child, and children are grouped into schools. Schools are nested within districts.  \n- each observation is an individual assessment, and we have multiple assessments for each patient, and patients are nested within hospitals. \n- each observation is an individual timepoint, and we have multiple timepoint per child. children are nested within schools  \n\nThis sort of structure is referred to as \"nested\" in that at each level, individual units belong to only _one_ of the higher up units. For instance, in a \"observations within children within schools\" structure, each observation belongs to only one child, and each child is at only one school. You can see this idea in @fig-nesting\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![A 'nested' structure, in which each level 1 unit belongs to a single level 2 unit, and each level 2 unit belongs to a single level 3 unit](images/structure_nestednew.png){#fig-nesting fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\nIn R, we can specify a nested structure using either of:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n... + (1 + ... | school) + (1 + .... | school:child)\n... + (1 + ... | school) + (1 + .... | child:school)\n```\n:::\n\n\n\nThis specifies that things can vary between schools and that things can also vary between the children within the schools. Note that when we use the colon `:` the order doesn't matter - it just means \"the combination of school and child variables\", so whether we group observations from child 1 in school A as \"A.1\" or \"1.A\" doesn't matter - it gets at the same group:  \n\nSo `(1 | school) + (1 | school:child)` means that the intercept varies by school (some schools have a higher $y$, some have lower), and also by the children within the schools (some children have a higher $y$ for the school, some have lower).  \n\nYou might think of this as the variance in school intercepts (width of purple distribution in @fig-intnest) and the variance in child intercepts around their school average (width of the right-hand distributions in @fig-intnest). In @fig-intnest below there is a lot of school-level variation, and less child-level variation, but you could just as likely have a situation in which children that vary a lot and schools vary less. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Lines for each child from 12 Schools. Purple distribution shows school-level variance in intercepts. Distributions to the right show the within-school child-level variance in intercepts](07_ranef_files/figure-html/fig-intnest-1.png){#fig-intnest fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n::: {.callout-note collapse=\"true\"}\n#### a shortcut\n\nIn __lme4__, there is a shortcut for writing nested random effects that uses the `/` to specify `higher/lower` level of nesting.  \n\nFor instance,  \n`(1 + .... | school/child)`  \nis the same thing as  \n`(1 + ... | school) + (1 + .... | school:child)`\n\nThis shortcut has a bit of a disadvantage in that it means all the same random slopes are fitted for schools and for children-within-schools, so often it is preferable to keep them separated out.  \n\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n#### uniqueness of labels\n\nIf labels of children are unique to each school, e.g. the child variable has values like \"school1_child1\", \"school2_child2\" etc., then \n`school:child` captures the same set of groups as `child` does, and therefore  \n`(1 + ... | school) + (1 + .... | school:child)`  \nis the same as  \n`(1 + ... | school) + (1 + .... | child)`  \n\n\nThe risk of just specifying `... |child` is that whether or not it gets at the correct groups depends on your labels. \n\n__in the `summary()` output of a multilevel model, immediately beneath the random effects it will show you how many groups. It's always worth checking that these match with how many you would expect!__   \n\n\n:::\n\n\n<div class=\"divider div-transparent div-dot\"></div>\n\n# Crossed\n\n\n\n\n\n\n\n\n\nCrossed structures are, in simplest terms, anything that is not nested. So if a unit of observation exists in more than one of another level, we have a crossed design - i.e. where there is not the same hierarchy to the structure.   \n\nFor instance:  \n\n- Each observation is an assessment of a patient by a therapist. Patients see various therapists, and therapists see many different patients (patients and therapists are not nested)\n- Each observation is an individual trial, which will be one from a set of experimental items. All participants see all items, and \"item 1\" for participant 1 is the same \"item 1\" as when we see it for participant 2, and 3, and so on.. So items are not nested within participants.  \n\nThis sort of structure is referred to as \"crossed\" because of the lines crossing in such diagrams as in @fig-crossed. In @fig-crossed, observations can be grouped into tasks, but they can also be grouped into participants.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![A 'crossed' structure](images/structure_crossednew.png){#fig-crossed fig-align='center' width=100%}\n:::\n:::\n\n\n\n\nIn R, we simply specify these as separate groupings\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n... + (1 + ... | participant) + (1 + .... | task)\n```\n:::\n\n\n\nThis specifies that things can vary between participants, and that things can also vary between tasks.  \n\nSo `(1 | participant) + (1 | task)` means that the intercept varies by participant (some people have a higher $y$, some have lower),b and also by tasks (some tasks result in a higher $y$, some lower).  \n\nIt's a bit more difficult to visualise, but @fig-crosstest shows two independent distributions representing the intercept variance between Participants (left) and between Tasks (right). \n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![A crossed design, with participant level variance (left) and task level variance (right)](07_ranef_files/figure-html/fig-crosstest-1.png){#fig-crosstest fig-align='center' width=100%}\n:::\n:::\n\n\n\n\nWe can see in @fig-crosstest, for instance, that \"PPT_9\" tends to have a higher $y$, and that \"Task_5\" tends to have lower scores etc. Combined, these imply our model fitted values as shown for just 4 of the participants in @fig-crosstest2.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![fitted values from a crossed design for a sample of 4 participants](07_ranef_files/figure-html/fig-crosstest2-1.png){#fig-crosstest2 fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n<div class=\"divider div-transparent div-dot\"></div>\n\n# Examples\n\n## Example 1: Two levels\n\nBelow is an example of a study that has a similar structure to those that we've seen thus far, in which we have just two levels (observations that are grouped in some way).  \n\n::::panelset\n:::panel\n#### Study Design\n\nSuppose, for instance, that we conducted an experiment on a sample of 20 staff members from the Psychology department to investigate effects of CBD consumption on stress over the course of the working week. Participants were randomly allocated to one of two conditions: the control group continued as normal, and the CBD group were given one CBD drink every day. Over the course of the working week (5 days) participants stress levels were measured using a self-report questionnaire.  \n\nWe can see our data here:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npsychstress <- read_csv(\"https://uoepsy.github.io/data/stressweek1.csv\")\nhead(psychstress)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  dept  pid   CBD   measure       day stress\n  <chr> <chr> <chr> <chr>       <dbl>  <dbl>\n1 Psych Holly N     Self-report     1 -0.417\n2 Psych Holly N     Self-report     2  0.924\n3 Psych Holly N     Self-report     3  0.634\n4 Psych Holly N     Self-report     4  1.21 \n5 Psych Holly N     Self-report     5  0.506\n6 Psych Tom   Y     Self-report     1 -0.557\n```\n\n\n:::\n:::\n\n\n\n\n:::\n:::panel\n#### Plot\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\n# take the dataset, and make the x axis of our plot the 'day' variable, \n# and the y axis the 'stress' variable: \n# color everything by the CBD groups\nggplot(psychstress, aes(x = day, y = stress, col=CBD)) + \n  geom_point() + # add points to the plot\n  geom_line() + # add lines to the plot\n  facet_wrap(~pid) # split it by participant\n```\n\n::: {.cell-output-display}\n![](07_ranef_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n:::\n:::panel\n#### Model\n\nWe might fit a model that looks something like this:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(lme4)\n# re-center 'day' so the intercept is day 1\npsychstress$day <- psychstress$day-1 \n\n# fit a model of stress over time: stress~day\n# estimate differences between the groups in their stress change: day*CBD\n# people vary in their overall stress levels: 1|pid\n# people vary in their how stress changes over the week: day|pid\nm2level <- lmer(stress ~ 1 + day * CBD + \n                  (1 + day | pid), data = psychstress)\n```\n:::\n\n\n\n\nNote that there is a line in the model summary output just below the random effects that shows us the information about the groups, telling us that we have 100 observations that are grouped into 20 different participants'.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(m2level)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: stress ~ 1 + day * CBD + (1 + day | pid)\n   Data: psychstress\n\nREML criterion at convergence: 127.7\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.17535 -0.65204 -0.02667  0.64622  1.81574 \n\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr\n pid      (Intercept) 0.199441 0.44659      \n          day         0.004328 0.06579  0.02\n Residual             0.112462 0.33535      \nNumber of obs: 100, groups:  pid, 20\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  0.13178    0.14329   0.920\nday          0.07567    0.03461   2.186\nCBDY        -0.08516    0.24221  -0.352\nday:CBDY    -0.19128    0.05851  -3.270\n\nCorrelation of Fixed Effects:\n         (Intr) day    CBDY  \nday      -0.339              \nCBDY     -0.592  0.201       \nday:CBDY  0.201 -0.592 -0.339\n```\n\n\n:::\n:::\n\n\n\n\n\n:::\n::::\n\n## Example 2: Three level Nested\n\nLet's suppose that instead of simply sampling 20 staff members from the Psychology department, we instead went out and sampled lots of people from different departments across the University. The dataset below contains not just our 20 Psychology staff members, but also data from 220 other people from departments such as History, Philosophy, Art, etc..  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nneststress <- read_csv(\"https://uoepsy.github.io/data/stressweek_nested.csv\")\nhead(neststress)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  dept  pid      CBD   measure       day stress\n  <chr> <chr>    <chr> <chr>       <dbl>  <dbl>\n1 CMVM  Ryan     Y     Self-report     1  0.933\n2 CMVM  Ryan     Y     Self-report     2  0.997\n3 CMVM  Ryan     Y     Self-report     3  0.408\n4 CMVM  Ryan     Y     Self-report     4  0.581\n5 CMVM  Ryan     Y     Self-report     5  0.442\n6 CMVM  Nicholas Y     Self-report     1  0.138\n```\n\n\n:::\n:::\n\n\n\n\nIn this case, we have observations that are grouped by participants, and those participants can be grouped into the department in which they work. Three levels of nesting!  \n\nYou can see in the @fig-neststress1 below that there is variation between departments (i.e. people working in Art are a bit more relaxed, Political Science and CMVM is stressful, etc), and then _within_ each of those, there is variation between participants (i.e. some people working in Art are more stressed than other people in Art).  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(neststress, aes(x=day, y=stress,col=CBD))+\n  # plot points\n  geom_point()+\n  # split by departments\n  facet_wrap(~dept)+\n  # make a line for each participant\n  geom_line(aes(group=pid),alpha=.3)+ \n  # plot the mean and SE for each day.\n  stat_summary(geom=\"pointrange\",col=\"black\")\n```\n\n::: {.cell-output-display}\n![A longitudinal study in which participants are nested within department](07_ranef_files/figure-html/fig-neststress1-1.png){#fig-neststress1 fig-align='center' width=80%}\n:::\n:::\n\n\n\n\nTo account for these multiple sources of variation, we can fit a model that says both `( ... | dept)` (\"things vary by department\") _and_ `( ... | dept:pid)` (\"things vary by participants within departments\").  \n\nSo a model might look something like this:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# re-center 'day' so the intercept is day 1\nneststress$day <- neststress$day-1\n\nmnest <- lmer(stress ~ 1 + day * CBD + \n                (1 + day * CBD | dept) +\n                (1 + day | dept:pid), data = neststress)\n```\n:::\n\n\n\n\nNote that we can have different random slopes for departments vs those for participants. Our model above includes all random slopes that are feasible given the study design.  \n\n::: {.callout-tip collapse=\"true\"}\n#### explanations of each random slope\n\n- <small>participants can vary in their baseline stress levels.</small>\n    + `(1 | dept:pid)`\n- <small>participants can vary in how stress changes over the week. e.g., some participants might get more stressed over the week, some might get less stressed</small>\n    + `(days | dept:pid)`  \n- <small>participants cannot vary in how CBD changes their stress level. because each participant is _either_ CBD _or_ control, \"the effect of CBD on stress\" doesn't exist for a single participant (and so can't very between participants)</small>\n    + ~~`(CBD | dept:pid)`~~  \n- <small>participants cannot vary in how CBD affects their changes in stress over the week. For the same reason as above.</small>  \n    + ~~`( day*CBD | dept:pid)`~~\n- <small>departments can vary in their baseline stress levels.</small>\n    + `(1 | dept)`  \n- <small>departments can vary in how stress changes over the week.</small>  \n    + `(days | dept)`\n- <small>departments can vary in how CBD changes stress levels. because each department contains some participants in the CBD group and some in the control group, \"the effect of CBD on stress\" _does_ exist for a given department, and so _could_ vary between departments. e.g. Philosophers taking CBD get really relaxed, but CBD doesn't affect Mathematicians that much.</small> \n    + `(CBD | dept)`  \n- <small>departments can vary in how CBD affects changes in stress over the week</small>\n    + `( day*CBD | dept)`  \n\n:::\n\nNote that the above model is a singular fit, but it gives us a better place to start simplifying from. If we remove the `day*CBD` interaction in the by-department random effects, we get a model that converges:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmnest2 <- lmer(stress ~ 1 + day * CBD + \n                (1 + day + CBD | dept) +\n                (1 + day | dept:pid), data = neststress)\n```\n:::\n\n\n\n\nAnd plot our fitted values\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(broom.mixed)\naugment(mnest2) |> \n  ggplot(aes(x=day, y=.fitted, col=CBD))+\n    # split by departments\n    facet_wrap(~dept) + \n    # make a line for each participant\n    geom_line(aes(group=pid),alpha=.3)+\n    # average fitted value for CBD vs control:  \n    stat_summary(geom=\"line\",aes(col=CBD),lwd=1)\n```\n\n::: {.cell-output-display}\n![Plot of fitted values of the model. Individual lines for each participant, facetted by department. Thicker lines represent the department average fitted values split by CBD group](07_ranef_files/figure-html/fig-plotfitnest-1.png){#fig-plotfitnest fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\nAnd we can see in our summary that there is a lot of by-department variation - departments vary in their baseline stress levels with a standard deviation of 0.81, and within departments, participants vary in baseline stress scores with a standard deviation of 0.38. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(mnest2)\n```\n:::\n\n\n\n```\n...\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr       \n dept:pid (Intercept) 0.147661 0.38427             \n          day         0.012142 0.11019  -0.03      \n dept     (Intercept) 0.648410 0.80524             \n          day         0.001979 0.04449  -0.18      \n          CBDY        0.055388 0.23535   0.40 -0.22\n Residual             0.129765 0.36023             \nNumber of obs: 1200, groups:  dept:pid, 240; dept, 12\n...\n```\n\nExamining `ranef(mnest2)` now gives us a list of `dept:pid` random effects, and then of `dept` random effects. We can plot them using `dotplot.ranef.mer()`, as seen below. From these, we can see for instance, that the effect of `CBD` is more negative for Theology, and Sociology and Maths have higher slopes of `day`. These map with the plot of fitted values we saw in @fig-plotfitnest - the department lines are going up more Math and Sociology than in other departments, and in Theology the blue CBD line is much lower relative to the red control line than in other departments.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndotplot.ranef.mer(ranef(mnest2))$dept\n```\n\n::: {.cell-output-display}\n![](07_ranef_files/figure-html/unnamed-chunk-22-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n## Example 3: Crossed\n\nForgetting about participants nested in departments, let's return to our sample of 20 staff members from the Psychology department. In our initial study design, we had just one self report measure of stress each day for each person.  \nHowever, we might just as easily have taken more measurements. i.e. on Day 1, we could have recorded Martin's stress levels 10 times. Furthermore, we could have used 10 different measurements of stress, rather than just a self-report measure. We could measure his cortisol levels, blood pressure, heart rate variability, give him different questionnaires, ask an informant like his son to report his stress, and so on. And we could have done the same for everybody.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nstresscross <- read_csv(\"https://uoepsy.github.io/data/stressweek_crossed.csv\")\nhead(stresscross)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  dept  pid   CBD   measure          day stress\n  <chr> <chr> <chr> <chr>          <dbl>  <dbl>\n1 Psych Aja   N     Alpha-Amylase      1  0.269\n2 Psych Aja   N     Blood Pressure     1  0.855\n3 Psych Aja   N     Cortisol           1  0.278\n4 Psych Aja   N     EEQ                1  0.470\n5 Psych Aja   N     HRV                1 -0.404\n6 Psych Aja   N     Informant          1  0.774\n```\n\n\n:::\n:::\n\n\n\n\nIn this case, we can group our participants in two different ways. For each participant we have 5 datapoints for each of 10 different measures of stress. So we have 5x10 = 50 observations for each participant. But if we group them by measure instead, then we have each measure 5 times for 20 participants, so 5x20 = 100 observations of each measure. And there is no hierarchy here - the \"blood pressure\" measure is the same measure for Martin as it is for Dan and Aja etc. It makes sense to think of by-measure variability as not being 'within-participants'.  \n\nThis means we can choose when plotting whether to split the plots by participants, with a different line for each measure (@fig-crosseg), or split by measure with a different line for each participant (@fig-crosseg1)\n\n::::panelset\n:::panel\n#### facet = participant, line = measure\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(stresscross, aes(x=day, y=stress, col=CBD))+\n  geom_point()+\n  #make a line for each measure\n  geom_line(aes(group=measure))+\n  facet_wrap(~pid)\n```\n\n::: {.cell-output-display}\n![crossed designs with participants and measures. we can facet by participant and plot a line for each measure](07_ranef_files/figure-html/fig-crosseg-1.png){#fig-crosseg fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n:::\n:::panel\n#### facet = measure, line = participant\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(stresscross, aes(x=day, y=stress, col=CBD))+\n  geom_point()+\n  # make a line for each ppt\n  geom_line(aes(group=pid))+\n  facet_wrap(~measure)\n```\n\n::: {.cell-output-display}\n![crossed designs with participants and measures. we can facet by measure and plot a line for each participant](07_ranef_files/figure-html/fig-crosseg1-1.png){#fig-crosseg1 fig-align='center' width=80%}\n:::\n:::\n\n\n\n:::\n::::\n\n\nWe can fit a model that therefore accounts for the by-participant variation (\"things vary between participants\") _and_ the by-measure variation (\"things vary between measures\"). \n\nSo a model might look something like this:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# re-center 'day' so the intercept is day 1\nstresscross$day <- stresscross$day-1\n\nmcross <- lmer(stress ~ 1 + day * CBD + \n                (1 + day * CBD | measure) +\n                (1 + day | pid), data = stresscross)\n```\n:::\n\n\n\n\nNote that just as with the nested example above, we can have different random slopes for measures vs those for participants, depending upon what effects can vary given the study design.  \n\nAs before, removing the interaction in the random effects achieves model convergence:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmcross2 <- lmer(stress ~ 1 + day * CBD + \n                (1 + day + CBD | measure) +\n                (1 + day | pid), data = stresscross)\n```\n:::\n\n\n\n\nAnd again we might plot our fitted values either of the ways we plotted our initial data in @fig-crosseg above, only with the `.fitted` values obtained from the `augment()` function:  \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\naugment(mcross2) |>\n  ggplot(aes(x=day, y=.fitted, col=CBD))+\n    geom_point()+\n    geom_line(aes(group=pid))+\n    facet_wrap(~measure)\n```\n\n::: {.cell-output-display}\n![](07_ranef_files/figure-html/unnamed-chunk-28-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\nOur random effect variances show the estimated variance in different terms (the intercept, slopes of day, effect of CBD) between participants, and between measures.  \nFrom the below it is possible to see, for instance, that there is considerable variability between how measures respond to CBD (they vary in the effect of CBD on stress with a standard deviation of 0.53)\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(mcross2)\n```\n:::\n\n\n\n```\n...\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr       \n pid      (Intercept) 0.316578 0.56265             \n          day         0.014693 0.12121  -0.51      \n measure  (Intercept) 0.087111 0.29515             \n          day         0.008542 0.09242   0.88      \n          CBDY        0.283635 0.53257  -0.10  0.11\n Residual             0.088073 0.29677             \nNumber of obs: 1000, groups:  pid, 20; measure, 10\n...\n```\n\nAgain, our dotplots of random effects help to also show this picture. We can see that the measures of \"blood pressure\", \"alpha-amylase\", \"cortisol\", and \"HRV\" all have more effects of CBD that are more negative. We can see this in our plot of fitted values - these measures look like CBD vs control differnce is greater than in other measures. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndotplot.ranef.mer(ranef(mcross2))$measure\n```\n\n::: {.cell-output-display}\n![](07_ranef_files/figure-html/unnamed-chunk-31-1.png){fig-align='center' width=80%}\n:::\n:::\n",
    "supporting": [
      "07_ranef_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/panelset-0.3.0/panelset.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/panelset-0.3.0/panelset.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}