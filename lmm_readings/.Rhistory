pdist = MASS::mvrnorm(1e5, mu=c(0,0),Sigma=VarCorr(m2)[[1]]) |>
as_tibble() |>
mutate(int=`(Intercept)`)
as.data.frame(ranef(m2)$g) |>
rownames_to_column() |>
mutate(int=`(Intercept)`,rowname=factor(rowname,levels=1:10)) |>
ggplot(aes(x=int,y=x)) +
guides(col="none")+
stat_smooth(se=F,fullrange=T,col="black",size=.5)+
with_blur(geom_point(aes(col=rowname),size=3,alpha=.8),sigma=1) +
#geom_density2d(data=pdist[1:1e4,]) +
scale_x_continuous("intercepts")+
scale_y_continuous("slopes")+
geom_xsidedensity(data=pdist,fill="#a41ae4", alpha=.4,col=NA)+
geom_ysidedensity(data=pdist,fill="#a41ae4", alpha=.4, col=NA)+
theme_ggside_void() -> pp5
pdist = MASS::mvrnorm(1e5, mu=c(0,0),Sigma=VarCorr(m3)[[1]]) |>
as_tibble() |>
mutate(int=`(Intercept)`)
as.data.frame(ranef(m3)$g) |>
rownames_to_column() |>
mutate(int=`(Intercept)`,rowname=factor(rowname,levels=1:10)) |>
ggplot(aes(x=int,y=x)) +
guides(col="none")+
#stat_smooth(se=F,fullrange=T,col="black",size=.5)+
with_blur(geom_point(aes(col=rowname),size=3,alpha=.8),sigma=1) +
geom_density2d(data=pdist[1:1e4,],col="black") +
scale_x_continuous("intercepts")+
scale_y_continuous("slopes")+
geom_xsidedensity(data=pdist,fill="#a41ae4", alpha=.4,col=NA)+
geom_ysidedensity(data=pdist,fill="#a41ae4", alpha=.4, col=NA)+
theme_ggside_void() -> pp6
(pp1 + pp3 + pp2)/(pp4 + pp6 + pp5)
set.seed(665)
N = 100
n_groups = 10
g = rep(1:n_groups, e = N/n_groups)
x = rep(0:9,n_groups)
re0 = rnorm(n_groups, sd = 1)
re = re0[g]
rex = re0/2
re_x = rex[g]
lp = (0 + re) + (1 + re_x) * x
y = rnorm(N, mean = lp, sd = .1)
d1=data.frame(x, g = factor(g), y)
rex = -1*re0/2
re_x = rex[g]
lp = (0 + re) + (.1 + re_x) * x
y = rnorm(N, mean = lp, sd = .1)
d2=data.frame(x, g = factor(g), y)
while(TRUE){
rex <<- rnorm(n_groups, sd = 1)
if(abs(cor(re0,rex))<.01){break}
}
re_x = rex[g]
lp = (0 + re) + (.1 + re_x) * x
y = rnorm(N, mean = lp, sd = .1)
d3=data.frame(x, g = factor(g), y)
ggplot(d1)+
stat_smooth(aes(x=x,y=y,group=g,col=factor(g,levels=1:10)),method=lm,se=F,size=1)+
guides(col="none")+
labs(x="x1",y=".fitted",subtitle="cor(ints,slopes) = 1") +
scale_y_continuous(breaks=NULL) -> pp1
ggplot(d2)+
stat_smooth(aes(x=x,y=y,group=g,col=factor(g,levels=1:10)),method=lm,se=F,size=1)+
guides(col="none")+
labs(x="x1",y=".fitted",subtitle="cor(ints,slopes) = -1")+
scale_y_continuous(breaks=NULL) -> pp2
ggplot(d3)+
stat_smooth(aes(x=x,y=y,group=g,col=factor(g,levels=1:10)),method=lm,se=F,size=1)+
guides(col="none")+
labs(x="x1",y=".fitted",subtitle="cor(ints,slopes) = 0")+
scale_y_continuous(breaks=NULL) -> pp3
#
m1 = lmer(y~1+x+(1+x||g),d1)
#VarCorr(m1)
m2 = lmer(y~1+x+(1+x||g),d2)
#VarCorr(m2)
m3 = lmer(y~1+x+(1+x||g),d3)
#VarCorr(m3)
library(ggside)
pdist = MASS::mvrnorm(1e5, mu=c(0,0),Sigma=diag(2)*unlist(VarCorr(m1))) |>
as_tibble() |>
mutate(int=V1,x=V2)
as.data.frame(ranef(m1)$g) |>
rownames_to_column() |>
mutate(int=`(Intercept)`,rowname=factor(rowname,levels=1:10)) |>
ggplot(aes(x=int,y=x)) +
guides(col="none")+
stat_smooth(se=F,fullrange=T,col="black",size=.5)+
with_blur(geom_point(aes(col=rowname),size=3,alpha=.8),sigma=1) +
#geom_density2d(data=pdist[1:1e4,]) +
scale_x_continuous("intercepts")+
scale_y_continuous("slopes")+
geom_xsidedensity(data=pdist,fill="#a41ae4", alpha=.4,col=NA)+
geom_ysidedensity(data=pdist,fill="#a41ae4", alpha=.4, col=NA)+
theme_ggside_void() -> pp4a
pdist = MASS::mvrnorm(1e5, mu=c(0,0),Sigma=diag(2)*unlist(VarCorr(m2))) |>
as_tibble() |>
mutate(int=V1,x=V2)
as.data.frame(ranef(m2)$g) |>
rownames_to_column() |>
mutate(int=`(Intercept)`,rowname=factor(rowname,levels=1:10)) |>
ggplot(aes(x=int,y=x)) +
guides(col="none")+
stat_smooth(se=F,fullrange=T,col="black",size=.5)+
with_blur(geom_point(aes(col=rowname),size=3,alpha=.8),sigma=1) +
#geom_density2d(data=pdist[1:1e4,]) +
scale_x_continuous("intercepts")+
scale_y_continuous("slopes")+
geom_xsidedensity(data=pdist,fill="#a41ae4", alpha=.4,col=NA)+
geom_ysidedensity(data=pdist,fill="#a41ae4", alpha=.4, col=NA)+
theme_ggside_void() -> pp5a
pdist = MASS::mvrnorm(1e5, mu=c(0,0),Sigma=diag(2)*unlist(VarCorr(m3))) |>
as_tibble() |>
mutate(int=V1,x=V2)
as.data.frame(ranef(m3)$g) |>
rownames_to_column() |>
mutate(int=`(Intercept)`,rowname=factor(rowname,levels=1:10)) |>
ggplot(aes(x=int,y=x)) +
guides(col="none")+
#stat_smooth(se=F,fullrange=T,col="black",size=.5)+
with_blur(geom_point(aes(col=rowname),size=3,alpha=.8),sigma=1) +
geom_density2d(data=pdist[1:1e4,],col="black") +
scale_x_continuous("intercepts")+
scale_y_continuous("slopes")+
geom_xsidedensity(data=pdist,fill="#a41ae4", alpha=.4,col=NA)+
geom_ysidedensity(data=pdist,fill="#a41ae4", alpha=.4, col=NA)+
theme_ggside_void() -> pp6a
#(pp1 + pp3 + pp2)/(pp4a + pp6a + pp5a)
pp4 | pp4a
library(lavaan)
library(lavaan)
m="
x
y
x~~0*y
"
diag(1)
diag(2)
diag(2)
matrix(c(2,1,1,2),nrow=2)
MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
cov(df)
sem(m,df)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df)
sem(m,df) |> partable()
cov(df)
sem(m,df,fixed.x=F) |> partable()
library(lavaan)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
library(lavaan)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
m="
x~~y
"
sem(m,df,fixed.x=F) |> partable()
cov(df)
library(lavaan)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
library(lavaan)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
library(lavaan)
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
m0="
x~~0*y
"
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
sem(m,df,fixed.x=F) |> partable()
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~0*y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cov(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
cor(df)
cor(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(2,1,1,2),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
library(lavaan)
m0="
x~~0*y
"
m="
x~~y
"
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
partable(sem(m0,df,fixed.x=F))[2:3,"est"]
partable(sem(m,df,fixed.x=F))[2:3,"est"]
tt <- function(){
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
c(partable(sem(m0,df,fixed.x=F))[2:3,"est"],
partable(sem(m,df,fixed.x=F))[2:3,"est"])
}
tt()
c(partable(sem(m0,df,fixed.x=F))[2:3,"est"],
partable(sem(m,df,fixed.x=F))[2:3,"est"])
c(partable(sem(m0,df,fixed.x=F))[2:3,"est"],
partable(sem(m,df,fixed.x=F))[2:3,"est"])
tt <- function(){
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
c(partable(sem(m0,df,fixed.x=F))[2:3,"est"],
partable(sem(m,df,fixed.x=F))[2:3,"est"])
}
res = replicate(1e3,tt())
tt <- function(){
dd=MASS::mvrnorm(n=5e2, mu=c(0,0),Sigma=matrix(c(1,.6,.6,1),nrow=2))
df=data.frame(
x=dd[,1],
y=dd[,2]
)
cor(df)
c(partable(sem(m0,df,fixed.x=F))[2:3,"est"],
partable(sem(m,df,fixed.x=F))[2:3,"est"])
}
res = replicate(2e2,tt())
tibble(
e = res,
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
)
res
dim(Res)
t(res)
res = as.data.frame(t(res))
head(res)
pivot_longer(res,everything())
pivot_longer(res,everything()) |> mutate(
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
)
pivot_longer(res,everything()) |> mutate(
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> ggplot(aes(x=m,y=value))+
stat_summary(geom="pointrange")+facet_wrap(~v)
pivot_longer(res,everything()) |> mutate(
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> pivot_wider(names_from=m,values_from=value)
pivot_longer(res,everything()) |> mutate(
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> pivot_wider(names_from=m,values_from=value) |>
unnest()
pivot_longer(res,everything()) |> mutate(
s = rep(1:212,4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
)
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
)
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> pivot_wider(names_from=m,values_from=value)
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> select(-name) |> pivot_wider(names_from=m,values_from=value)
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> select(-name) |> pivot_wider(names_from=m,values_from=value)  |>
mutate(d = `1`-`0`)
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> select(-name) |> pivot_wider(names_from=m,values_from=value)  |>
mutate(d = `1`-`0`) |> hist()
pivot_longer(res,everything()) |> mutate(
s = rep(1:2e2,e=4),
m = rep(c(0,0,1,1),2e2),
v = rep(c("x","y"),4e2)
) |> select(-name) |> pivot_wider(names_from=m,values_from=value)  |>
mutate(d = `1`-`0`) |> pull(d) |> hist()
